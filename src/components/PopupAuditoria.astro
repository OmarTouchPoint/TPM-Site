---
import Image from "astro/components/Image.astro";
import img from "../assets/images/home/auditoria-seo.png"

---
<style type="text/css">
    /* Please move these styles to your css file or just keep them here */
    #so-form {
        margin: 10px!important;
    }
    #so-fieldswrapso1755737871 {
        width: 100%!important;
    }
    /*.so-fieldso1755737871 {
        background-color: #FFFFFF!important;
        border: 1px solid #9f9f9f!important;
        border-radius: 20px !important;
        color: #4b5675!important;
        padding: 7px 12px!important;
        font-size: 18px!important;
        box-sizing: border-box !important;
        height: 45px!important;
               display: inline!important;
        margin-top: 5px!important;
    }
    .so-fieldso1755737871::placeholder {
        color: #99a1b7!important;
    }

    @media screen and (max-width: 345px){
        .so-fieldso1755737871 {
            min-width: 100px!important;
        }
    }

    @media screen and (max-width: 500px){
        .so-fieldso1755737871 {
            font-size: 12px !important;
            height: 30px !important;
        }

        #so-submitso1755737871 {
            font-size: 12px !important;
            height: 30px;
            padding: 1px 20px !important;
        }

        #so-fieldswrapso1755737871 {
            width: 100%;
        }

    }*/

    #so-submitso1755737871 {
        background-color: #DF1449!important;
        border: 1px solid #DF1449!important;
        color: #ffffff!important;
        border-radius: 20px !important;
        text-decoration: none!important;
        cursor: pointer!important;
        box-sizing: border-box !important;
        height: 45px!important;
 font-size: 18px!important;
 line-height: 18px!important;
 min-width: 130px!important;
        padding: 8px 20px!important;
        position: relative;
        margin-top: 5px!important;
    }


    @media screen and (max-width: 500px){
        #so-submitso1755737871 {
            font-size: 20px !important;
            height: 50px !important;
            padding: 0px 15px !important;
        }
    }

    .so-container {
        width: 100%;
        text-align: center;
    }
    .so-widget-form {
        /*display: inline-block !important;*/
    }
    #so-boxso1755737871 {
        display: inline-block;
    }
    #so-titleso1755737871 {
        margin-bottom: 5px;
    }

    @media screen and (max-width: 500px){
        #so-titleso1755737871 {
            font-size: 25px !important;
        }

        #so-paragraphso1755737871 {
            font-size: 10px !important;
        }

        #so-consentso1755737871 span {
            font-size: 10px !important;
        }
    }

    #so-paragraphso1755737871 {
        margin-bottom: 10px;
        font-size: 14px !important;
        color: #78829d !important;
    }
    #so-boxso1755737871 {
        width: 100%;
        padding: 50px !important;
        /*background-color: #fcfcfc !important;*/
        /*border: 1px solid #dbdfe9 !important;*/
    }
    @media screen and (max-width: 1039px){
        #so-boxso1755737871 {
            padding: 50px 10px !important;
            /*background-color: #fcfcfc !important;*/
            /*border: 1px solid #dbdfe9 !important;*/
        }
    }
    @media screen and (max-width: 1039px){
        #so-boxso1755737871 {
            padding: 25px 5px !important;
        }
    }

    /* Modal */
    /* --- CTA secundario (sin cambios) --- */
    .seo-cta-secondary { margin-top: 30px; font-size: 0.95rem; }
    .seo-cta-secondary a {
        cursor: pointer;
        color: #ffffff;
        font-size: 15px;
        font-weight: 400;
        text-decoration: none;
    }

    /* --- Modal base (sin cambios en la base) --- */
    .seo-modal[aria-hidden="true"] { display: none; }
    .seo-modal {
        position: fixed; inset: 0; z-index: 9999;
        display: grid; place-items: center;
    }
    .seo-modal__overlay {
        position: absolute; inset: 0; background: rgba(0,0,0,.5);
    }
    
    /* MODIFICACIONES AQUI: El nuevo diseño del diálogo */
    .seo-modal__dialog {
        position: relative; width: min(890px, 92vw); /* Ancho más amplio para las dos columnas */
        background: #fff; border-radius: 14px;
        box-shadow: 0 20px 60px rgba(0,0,0,.25);
        max-height: 90vh;
        padding: 0; /* Eliminamos el padding del diálogo */
        transform: translateY(10px); opacity: 0;
        transition: opacity .2s ease, transform .2s ease;
        
        /* Flexbox para alinear el contenido principal */
        display: flex;
    }
    .seo-modal[aria-hidden="false"] .seo-modal__dialog {
        transform: translateY(0); opacity: 1;
    }

    /* Estilos del botón de cierre */
    .seo-modal__close {
        position: absolute; top: 15px; right: 15px;
        width: 30px; height: 30px; border-radius: 50%;
        border: none; background: #ffffff; cursor: pointer; font-size: 22px; line-height: 1;
        margin: 0;padding: 0; color: #a30f47;
    }
    .seo-modal__close:hover { background: #f2f2f2; }

    /* Los siguientes selectores ya no se usan con el nuevo HTML, los eliminamos */
    /* .seo-modal__content { padding-top: 18px; } */
    /* .seo-modal__form-wrapper { margin-inline: auto; max-width: 560px; } */
    
    /* Nuevo wrapper para el contenido de las dos columnas */
    .seo-modal__wrapper {
        display: flex;
        width: 100%;
    }

    /* Contenedor visual izquierdo */
    .seo-modal__visual-container {
        flex: 1; /* Ocupa la mitad del espacio */
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #ffffffff; /* Color de fondo */
        border-radius: 14px 0 0 14px; /* Bordes redondeados solo en la izquierda */
        position: relative;
        overflow: hidden;
    }
    /* Estilos para la ilustración */
    .seo-modal__illustration img {
        display: block;
        max-width: 100%;
        height: auto;
    }

    /* Contenedor del formulario derecho */
    .seo-modal__form-container {
        flex: 1; /* Ocupa la otra mitad del espacio */
        padding: 30px; /* Padding interno para el formulario */
        padding-top: 50px; /* Espacio extra arriba para el título */
        background: #ffffff;
        border-radius: 0 14px 14px 0;
    }

    /* Título del formulario */
    #so-titleso1755737871 {
        margin: 0 0 20px;
        font-size: 2rem;
        line-height: 1.2;
        color: #01232F;
        font-weight: 700;
    }
    .seo-modal__form-container p{
        margin: 0 0 20px;
        font-size: 1rem;
        color: #4C4C4C;
    }

    /* Campos de texto */
    #so-fieldswrapso1755737871 {
        display: grid;
        gap: 16px; /* Aumentamos el espacio entre campos */
        grid-template-columns: 1fr; 
    }
    #so-fieldswrapso1755737871 input[type="text"],
    #so-fieldswrapso1755737871 input[type="email"] {
        width: 100%;
        padding: 16px 20px; /* Aumentamos el padding */
        border: 1px solid #d8dee3;
        border-radius: 0px; /* Redondeamos un poco los bordes */
        font-size: 1rem;
    }
    
    /* Botón de envío */
    #so-submitso1755737871 {
        display: inline-block;
        width: 100%; /* El botón ocupa todo el ancho */
        padding: 16px 20px;
        border: 0;
        border-radius: 8px; /* Bordes más rectangulares */
        background: #DF1449;
        color: #fff;
        font-weight: 700;
        cursor: pointer;
        text-align: center;
        border-radius: 0px !important;
    }
    #so-submitso1755737871:hover { filter: brightness(1.1); }
    @media screen and (max-width: 767px){
        .seo-cta-secondary a {
            font-size:0.8rem;
        }
        .seo-modal__close{
            z-index: 10;
            border: solid;
        }
        .seo-modal__wrapper{
            display: block;
        }
        .seo-modal__illustration{
            padding: 5% 20% 0%;
        }
        .seo-modal__form-container{
            padding: 20px 30px;
        }
    }

</style>
<!-- Modal SEO Audit -->
<div class="seo-modal" id="seoAuditModal" role="dialog" aria-modal="true" aria-labelledby="seoModalTitle" aria-hidden="true">
    <div class="seo-modal__overlay" data-close="seo-modal"></div>

    <div class="seo-modal__dialog" role="document">
        <button type="button" class="seo-modal__close" aria-label="Cerrar" data-close="seo-modal">×</button>

        <div class="seo-modal__wrapper">
            <div class="seo-modal__visual-container">
                <div class="seo-modal__visual-content">
                    <div class="seo-modal__illustration">
                        <Image src={img} alt="Auditoría SEO en laptop"/>
                    </div>
                </div>
            </div>

            <div class="seo-modal__form-container">
                <div id="so-titleso1755737871">¿Tu sitio está listo<br>para convertir visitantes?</div>
                <p>Audita su desempeño ahora, en segundos.</p>
                <form class="so-widget-form" id="so1755737871" name="form_AuditoriaSEO" action="https://seoreport.touchpointmarketing.mx/process-embedded.inc" target="so-iframe" data-behaviour="modal" data-title="Informe web para " data-touch="Muchas gracias por solicitar un informe. ¡Estaremos en contacto pronto!" onsubmit="return soSubmit(this)">
                    <input id="so-typeso1755737871" type="hidden" name="type" value="pdf">
                    <input type="hidden" name="uid" value="81671">
                    <input type="hidden" name="csrf_token" value="92893baa684c516a944467a1a65b086998f0c257">
                    <input type="hidden" name="behaviour" value="modal">
                    <input type="hidden" name="template" value="9879">
                    <input id="so-buttonso1755737871" type="hidden" name="button" value="https://go.tpm.marketing/U8iesm" title="Quiero mejorar el SEO de mi página web">
                    <div id="so-fieldswrapso1755737871">
                        <input type="text" name="domain" id="so-domainso1755737871" class="so-fieldso1755737871" placeholder="Url del sitio web" data-validation="Incluye una URL correcta del sitio web. Solo se aceptan páginas de inicio.">
                        <input type="text" name="email" id="so-emailso1755737871" class="so-fieldso1755737871" placeholder="Correo electrónico" data-validation="Introduce una dirección de correo electrónico válida.">
                        <input type="submit" id="so-submitso1755737871" value="Quiero mi Auditoría Web">
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    function soSubmit(el) {
        if (!soFormValidate(el)) {
            //e.preventDefault();
            return false;
        }
        const behaviour = el.getAttribute('data-behaviour');
        soBody = document.getElementsByTagName("body")[0];
        soBodyOriginalStyleHeight = soBody.style.height;
        soBodyOriginalStyleOverflow = soBody.style.overflow;
        const element = document.createElement("input");
        element.setAttribute("type", "hidden");
        element.setAttribute("name", "referrer");
        element.setAttribute("value", window.location.href);
        el.appendChild(element);
        if (behaviour == 'new_tab') return true;
        if (behaviour == 'modal') return soSubmitModal(el);
        if (behaviour == 'be_in_touch') return soSubmitBeInTouch(el);
        if (behaviour == 'redirect') return soSubmitRedirect(el);
    }

    function soFormValidate(el) {
        const domain = el.querySelector('input[name="domain"]');
        const email = el.querySelector('input[name="email"]');
        const phone = el.querySelector('input[name="phone"]');
        const firstName = el.querySelector('input[name="first_name"]');
        const lastName = el.querySelector('input[name="last_name"]');
        const custom = el.querySelector('input[name="custom_field"]');
        const consent = el.querySelector('input[name="consent"]');

        if (0 == domain.value.length)
            return alert(domain.getAttribute("data-validation")), !1;
        if (domain.value = domain.value.trim().replace(/\/$/, ""), !domain.value.match(/^(https?:\/\/)?[a-z\d\-]{1,62}\.[a-z\d\-]{1,62}(\.[a-z\d\-]{1,62})*$/i))
            return alert(domain.getAttribute("data-validation")), !1;
        if (null != firstName && 0 == firstName.value.length)
            return alert(firstName.getAttribute("data-validation")), !1;
        if (null != lastName && 0 == lastName.value.length)
            return alert(lastName.getAttribute("data-validation")), !1;
        if (null != email) {
            if (0 == email.value.length)
                return alert(email.getAttribute("data-validation")), !1;
            //var regex = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;
            const regex = /^(([^<>()[\]\.,;:\s@\"]+(\.[^<>()[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i;
            if (!regex.test(email.value))
                return alert(email.getAttribute("data-validation")), !1;
        }
        if (null != phone && 7 > phone.value.length)
            return alert(phone.getAttribute("data-validation")), !1;
        if (null != custom && 0 == custom.value.length)
            return alert(custom.getAttribute("data-validation")), !1;
        if (null != consent && false === consent.checked)
            return alert(consent.getAttribute("data-validation")), !1;

        setTimeout(function () {
            el.reset();
        }, 50);
        return true;
    }

    function soSubmitModal(el) {
        const modalWrapper = document.createElement("div");
        const button = el.querySelector('input[name="button"]');
        let html = "<style type=\"text/css\">\n" +
            "    @media (max-width:500px) { #so-widget-modal-content { width:100% !important; height:100% !important; margin-top:50px !important; } }\n" +
            "    @media (max-width:500px) and (max-height:550px) { #so-widget-modal-content { height:100% !important;} }\n" +
            "    @media (min-height:601px) and (max-height:750px) and (min-width:501px) { #so-widget-modal-content { margin-top:100px !important; } }\n" +
            "    @media (max-height:600px) and (min-width:501px) { #so-widget-modal-content { margin-top:80px !important; } }\n" +
            "    #iframe-wrapper {width: 100%;height: 100%;-webkit-overflow-scrolling: touch !important}\n" +
            "    #iframe-wrapper iframe {height: 100%;width: 100%;}\n" +
            "</style> \n" +
            "<div id=\"so-widget-modal-overlay\" style=\"position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); display:none; opacity:0; transition:opacity 0.3s ease;\">\n" +
            "\t\t\t<div id=\"so-widget-modal-content\" style=\"position:relative; width:80%; max-width: 1250px; height:80%; margin:120px auto 0; background:#fff;\">\n" +
            "\t\t\t\t<div style=\"width:100%; height:50px; position:absolute; top:-50px; background:white;\">\n" +
            "\t\t\t\t\t<span id=\"so-widget-modal-title\" style=\"position:absolute; left:15px; top:15px; font-size:16px; font-weight:bold;\"></span>\n";
        if (null != button) {
            const styles = window.getComputedStyle(el.querySelector('input[type="submit"]'));
            html += "\t\t\t\t\t<a href=\""+button.value+"\" id=\"so-widget-modal-button\" style=\"display: inline-block;position: absolute;top: 3px;right: 0;margin-right: 50px;text-decoration: none;background-color: "+styles.backgroundColor+";border: 1px solid "+styles.backgroundColor+";color: "+styles.color+" !important;border-radius: 3px;font-size: 19px;padding: 8px 50px;height: 27px;box-sizing: content-box;\">"+button.getAttribute("title")+"</a>\n";
        }
        html += "\t\t\t\t\t<span onclick=\"closeSoModal();\" style=\"display:inline-block; width:16px; height:16px; position:absolute; top:15px; right:15px; cursor:pointer; background-image:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAowAAAKMB8MeazgAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAB5SURBVDiNrZPRCcAwCEQfnUiySAZuF8kSWeH6Yz8KrQZMQAicJ+epAB0YwAmYJKIADLic0/GPPCbQAnLznCd/4NWUFfkgy1VjH8CryA95ApYltAiTRCZxpuoW+gz9WXE6NPeg+ra1UDIxGlWEObe4SGxY5fIxlc75Bkt9V4JS7KWJAAAAAElFTkSuQmCC59ef34356faa7edebc7ed5432ddb673d'); opacity:0.6;\"></span>\n" +
            "\t\t\t\t</div>\n" +
            "                <div id=\"iframe-wrapper\">\n" +
            "\t\t\t\t    <iframe name=\"so-iframe\" id=\"so-iframe\" scrolling=\"yes\" style=\"border:1px solid transparent; width:100%; height:100%; box-sizing:border-box;\"></iframe>\n" +
            "\t\t\t    </div>\n" +
            "\t\t\t</div>\n" +
            "\t\t</div>";
        modalWrapper.setAttribute('style', 'position:absolute; top:0; left:0; width:100%; z-index:9999999');
        modalWrapper.setAttribute('id', 'so-modal-wrapper');
        modalWrapper.innerHTML = html;
        document.body.appendChild(modalWrapper);

        let isMobile = false;
        if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)
            || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4))) isMobile = true;
        if (isMobile) {
            el.querySelector('input[name="type"]').value = 'web'
            if (null != button && 0 !== button.value.length) document.getElementById('so-widget-modal-title').style.display = "none";
        }

        const domain = el.querySelector('input[name="domain"]').value;
        const soOverlay = document.getElementById('so-widget-modal-overlay');
        soOverlay.style.display = "block";
        document.getElementById('so-widget-modal-title').innerText = el.getAttribute("data-title")+domain;
        soBody.style.height = '100%';
        soBody.style.overflow = 'hidden';
        setTimeout(function () {
            soOverlay.style.opacity = 1;
        }, 50);
        return true;
    }

    function soSubmitBeInTouch(el) {
        const iframe = document.createElement("iframe");
        const element = document.createElement("input");
        element.setAttribute("type", "hidden");
        element.setAttribute("name", "be_in_touch");
        element.setAttribute("value", "1");
        el.appendChild(element);
        iframe.setAttribute('id', 'so-iframe');
        iframe.setAttribute('name', 'so-iframe');
        iframe.setAttribute('style', 'position:absolute; bottom:0; left:0; width:1px; height:1px; border:none');
        document.body.appendChild(iframe);
        alert(el.getAttribute("data-touch"));
        return true;
    }

    function soSubmitRedirect(el) {
        el.removeAttribute('target');
        return true;
    }

    function closeSoModal() {
        const soOverlay = document.getElementById('so-widget-modal-overlay');
        soOverlay.style.opacity = 0;
        document.getElementById('so-modal-wrapper').remove();
        setTimeout(function () {
            soBody.style.height = soBodyOriginalStyleHeight;
            soBody.style.overflow = soBodyOriginalStyleOverflow;
            soOverlay.style.display = "none";
        }, 300);
        // cierra también tu popup
        if (window.tpCloseSeoModal) window.tpCloseSeoModal();    }
    
    (function () {
    const modal     = document.getElementById('seoAuditModal');
    const dialog    = modal.querySelector('.seo-modal__dialog');
    const overlay   = modal.querySelector('.seo-modal__overlay');
    const closeBtns = modal.querySelectorAll('[data-close="seo-modal"]');
    const openBtn   = document.getElementById('openSeoAudit');
    const openBtnMenu = document.getElementById('openSeoAuditMenu');

    let lastFocused = null;

    function lockScroll(lock) {
        document.documentElement.style.overflow = lock ? 'hidden' : '';
        document.body.style.overflow = lock ? 'hidden' : '';
    }

    function openModal(trigger = null) {
        if (modal.getAttribute('aria-hidden') === 'false') return;
        lastFocused = trigger || document.activeElement;
        modal.setAttribute('aria-hidden', 'false');
        openBtn && openBtn.setAttribute('aria-expanded', 'true');
        lockScroll(true);
        // Mover foco al primer campo del formulario
        const firstInput = modal.querySelector('input[type="text"], input[type="email"]');
        (firstInput || dialog).focus();
        // Guardar en sessionStorage para no autoabrir otra vez en esta sesión
        try { sessionStorage.setItem('seoModalShown', '1'); } catch(e) {}
    }

    function closeModal() {
        if (modal.getAttribute('aria-hidden') === 'true') return;
        modal.setAttribute('aria-hidden', 'true');
        openBtn && openBtn.setAttribute('aria-expanded', 'false');
        lockScroll(false);
        if (lastFocused && typeof lastFocused.focus === 'function') lastFocused.focus();
    }
    window.tpCloseSeoModal = closeModal;   // API pública opcional

    // Cerrar con overlay o botón
    overlay.addEventListener('click', closeModal);
    closeBtns.forEach(btn => btn.addEventListener('click', closeModal));

    // Abrir con CTA
    openBtn.addEventListener('click', function (e) {
        e.preventDefault();
        openModal(this);
    });
    openBtnMenu.addEventListener('click', function (e) {
        e.preventDefault();
        openModal(this);
    });

    // Cerrar con ESC
    document.addEventListener('keydown', function (e) {
        if (e.key === 'Escape') closeModal();
    });

    // Trap de foco simple dentro del modal
    document.addEventListener('keydown', function (e) {
        if (modal.getAttribute('aria-hidden') === 'true') return;
        if (e.key !== 'Tab') return;

        const focusables = modal.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
        const list = Array.prototype.slice.call(focusables).filter(el => !el.disabled && el.offsetParent !== null);
        if (!list.length) return;

        const first = list[0];
        const last  = list[list.length - 1];

        if (e.shiftKey && document.activeElement === first) {
        e.preventDefault(); last.focus();
        } else if (!e.shiftKey && document.activeElement === last) {
        e.preventDefault(); first.focus();
        }
    });

    // Auto apertura a los 5s (solo una vez por sesión)
    window.addEventListener('load', function () {
        try {
        const already = sessionStorage.getItem('seoModalShown');
        if (!already) {
            setTimeout(() => openModal(openBtn), 7000);
        }
        } catch(e) {
        // Si sessionStorage falla, igual abrimos una sola vez
        setTimeout(() => openModal(openBtn), 7000);
        }
    });
    })();
</script>